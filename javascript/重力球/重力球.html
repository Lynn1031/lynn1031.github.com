<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>重力球</title>
<style>
html{ overflow:hidden;}

div{ position:absolute;left:100px; top:100px;width:100px; height:100px; border-radius: 50%;z-index:1;opacity: .7}


</style>
<script>
window.onload = function(){
	var aDiv=document.getElementsByTagName("div");
	var speedX = 0;
	var speedY = 0;
	var lastX = 0;
	var lastY = 0;
	var timer = null;	
	

	document.onclick=function(ev){
		
		var oEvent=ev||event;
		var l=oEvent.clientX;
		var t=oEvent.clientY;
		var oDiv = document.createElement("div");

		oDiv.style.left=oEvent.clientX-50+"px";
		oDiv.style.top=oEvent.clientY-50+"px";
		var r=parseInt(Math.random()*255);
		var g=parseInt(Math.random()*255);
		var b=parseInt(Math.random()*255);

		oDiv.style.backgroundColor="rgb("+r+","+g+","+b+")";
		document.body.appendChild(oDiv);


		oDiv.onmousedown = function(ev){
			
			clearInterval(timer);	
			var oEvent = ev || event;
			var disX = oEvent.clientX - oDiv.offsetLeft;
			var disY = oEvent.clientY - oDiv.offsetTop;
			document.onmousemove = function(ev){
				var oEvent = ev || event;
				oDiv.style.left = oEvent.clientX - disX + "px";
				oDiv.style.top  = oEvent.clientY - disY + "px";
				
				speedX = oDiv.offsetLeft - lastX;
				speedY = oDiv.offsetTop - lastY;
				lastX = oDiv.offsetLeft;
				lastY = oDiv.offsetTop;
				
			};
			document.onmouseup = function(){
				document.onclick=null;
				document.onmousemove = null;
				document.onmouseup = null;
				oDiv.releaseCapture && oDiv.releaseCapture();
				
				move(oDiv);

			};	
			oDiv.setCapture && oDiv.setCapture();
			return false;
		};
	};

	function move(oDiv){
			clearInterval(timer);
			timer = setInterval(function(){
				
				speedY += 3;
				
				var l = oDiv.offsetLeft + speedX;
				var t = oDiv.offsetTop + speedY;
				
				if(t >= document.documentElement.clientHeight - oDiv.offsetHeight){
					t = document.documentElement.clientHeight - oDiv.offsetHeight;
					speedY *= -0.8;
					speedX *= 0.8;
				} else if(t <= 0){
					t = 0;
					speedY *= -0.8;
					speedX *= 0.8;
				}
				
				if(l >= document.documentElement.clientWidth - oDiv.offsetWidth){
					l = document.documentElement.clientWidth - oDiv.offsetWidth;
					speedX *= -0.8;
					speedY *= 0.8;
				} else if(l <= 0){
					l = 0;
					speedX *= -0.8;
					speedY *= 0.8;
				}
				
				
				if(Math.abs(speedX) < 1){
					speedX = 0;
				}
				if(Math.abs(speedY) < 1){
					speedY = 0;
				}
				 
				
				if(speedX == 0 &&　speedY == 0 && t == document.documentElement.clientHeight - oDiv.offsetHeight){
					clearInterval(timer);	
				}
				
				oDiv.style.left = l + "px";
				oDiv.style.top = t + "px";	
			},30);	
	}
	

 
};
</script>
</head>

<body>
</body>
</html>
